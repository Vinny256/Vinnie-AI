<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vinnie AI Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9404499937977158"
     crossorigin="anonymous"></script>
</head>
<body data-logged-in="{{ 'true' if logged_in else 'false' }}">
  <button id="mobileSidebarToggle" class="mobile-sidebar-toggle" aria-label="Show Menu" type="button">
    <svg width="32" height="32" viewBox="0 0 32 32"><rect y="6" width="32" height="4" rx="2" fill="#2843c6"/><rect y="14" width="32" height="4" rx="2" fill="#2843c6"/><rect y="22" width="32" height="4" rx="2" fill="#2843c6"/></svg>
  </button>
  <div class="main-app">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-mobile-close-x" id="sidebarCloseX">&times;</div>
      <div class="sidebar-header">Welcome to Vinnie AI</div>
      <div class="sidebar-content">
        <div class="auth-section" {% if logged_in %}style="display:none"{% endif %}>
          <button class="btn-auth" type="button">Sign Up</button>
          <button class="btn-auth" type="button">Log In</button>
        </div>
        <div class="user-info" {% if not logged_in %}style="display:none"{% endif %}>
          <span class="username-display">ðŸ‘¤ {{ username }}</span>
          <button id="logoutBtn" type="button">Log Out</button>
        </div>
        <div class="history-header">Chat History</div>
        <ul class="history-list">
          {% for msg in chat_history %}
            <!---<li class="history-item">{{ msg.content[:30] }}</li> -->
            <li class="history-item" data-chatid="{{ msg.chat_id }}">{{ msg.content[:30] }}</li>
          {% endfor %}
        </ul>
      </div>
    </aside>
    <section class="chat-area" id="chatArea">
      <div id="suggestionMarquee" class="suggestion-marquee-container">
        <div class="suggestion-marquee-track">
          <button class="suggestion-button" type="button">What can you do?</button>
          <button class="suggestion-button" type="button">Summarize this text</button>
          <button class="suggestion-button" type="button">Translate to Swahili</button>
          <button class="suggestion-button" type="button">How does this work?</button>
        </div>
      </div>
<div class="chat-window" id="chatWindow">
  {% for chat in chat_sessions %}
    <div class="session-container" id="session-{{ chat.chat_id }}">
      <div class="session-title">{{ chat.title }}</div>
      <div class="messages">
        {% for msg in chat.messages %}
          <div class="message {{ 'user-message' if msg.role == 'user' else 'model-message' }}">
            <strong>{{ 'You:' if msg.role == 'user' else 'Vinnie AI:' }}</strong> {{ msg.content }}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>
<button id="newChatBtn" type="button">+ New Chat</button>
      <form id="multimodalForm" class="chat-input-bar">
        <textarea id="promptInput" name="prompt" placeholder="Type your question or analysis request here..." rows="2"></textarea>
        <div class="input-controls">
          <input type="file" id="fileInput" name="file" accept="image/*,application/pdf,audio/*,text/plain">
          <button type="submit" id="submitButton">Ask Question</button>
        </div>
        <span id="fileStatus" class="status-text">No file attached.</span>
      </form>
    </section>
  </div>

<!-- Login Modal -->
<div id="loginModal" class="auth-modal" style="display:none">
  <div class="auth-modal-content">
    <span class="auth-modal-close" id="closeLoginModal">&times;</span>
    <form id="loginForm" class="auth-form" autocomplete="on">
      <h2>Log In</h2>
      <label for="loginUsername">Username</label>
      <input type="text" id="loginUsername" name="username" required autofocus>
      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" name="password" required>
      <button type="submit">Log In</button>
      <p>New here? <a href="#" id="showSignupLink">Sign Up</a></p>
      <div class="form-error" id="loginError" style="display:none;"></div>
    </form>
  </div>
</div>

<!-- Signup Modal -->
<div id="signupModal" class="auth-modal" style="display:none">
  <div class="auth-modal-content">
    <span class="auth-modal-close" id="closeSignupModal">&times;</span>
    <form id="signupForm" class="auth-form" autocomplete="on">
      <h2>Sign Up</h2>
      <label for="signupUsername">Username</label>
      <input type="text" id="signupUsername" name="username" required autofocus>
      <label for="signupPassword">Password</label>
      <input type="password" id="signupPassword" name="password" required>
      <button type="submit">Sign Up</button>
      <p>Already registered? <a href="#" id="showLoginLink">Log In</a></p>
      <div class="form-error" id="signupError" style="display:none;"></div>
    </form>
  </div>
</div>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
